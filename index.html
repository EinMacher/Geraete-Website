<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Ger√§teverwaltung - Hochschule Bochum</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Arial', sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #fff;
    }
    
    /* Header */
    .header {
      background: #fff;
      border-bottom: 1px solid #e0e0e0;
      padding: 0;
    }
    
    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 30px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .logo-section {
      display: flex;
      align-items: center;
    }
    
    .logo {
      background: #E0002B;
      color: white;
      font-weight: bold;
      font-size: 24px;
      padding: 8px 12px;
      margin-right: 15px;
    }
    
    .university-name {
      font-size: 28px;
      font-weight: bold;
      color: #333;
    }
    
    .tagline {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 2px;
    }
    
    .nav-main {
      display: flex;
      gap: 30px;
    }
    
    .nav-main a {
      color: #8B0000;
      text-decoration: none;
      font-weight: 500;
      font-size: 14px;
    }
    
    .nav-main a:hover {
      color: #E0002B;
    }
    
    
    /* Main Content */
    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 30px;
      min-height: 60vh;
    }
    
    .page-title {
      font-size: 36px;
      color: #333;
      margin-bottom: 30px;
      font-weight: bold;
    }
    
    .device-detail {
      background: #f8f9fa;
      padding: 30px;
      border-radius: 8px;
      border-left: 4px solid #E0002B;
      margin-bottom: 30px;
    }
    
    .device-name {
      font-size: 28px;
      color: #E0002B;
      margin-bottom: 20px;
      font-weight: bold;
    }
    
    .device-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .info-item {
      display: flex;
      flex-direction: column;
    }
    
    .info-label {
      font-weight: bold;
      color: #666;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 5px;
    }
    
    .info-value {
      font-size: 18px;
      color: #333;
    }
    
    .status-available {
      color: #28a745;
      font-weight: bold;
    }
    
    .status-borrowed {
      color: #E0002B;
      font-weight: bold;
    }
    
    .status-defect {
      color: #dc3545;
      font-weight: bold;
    }
    
    .borrow-btn {
      background: #E0002B;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .borrow-btn:hover {
      background: #c00024;
    }
    
    .borrow-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    /* Device List */
    .device-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    
    .category-section {
      margin-bottom: 50px;
    }
    
    .category-title {
      font-size: 24px;
      color: #E0002B;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #E0002B;
    }
    
    .device-card {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      transition: box-shadow 0.3s, transform 0.3s;
      cursor: pointer;
    }
    
    .device-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transform: translateY(-2px);
    }
    
    .device-card h3 {
      color: #E0002B;
      font-size: 18px;
      margin-bottom: 10px;
    }
    
    .device-id {
      background: #f0f0f0;
      color: #666;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      display: inline-block;
      margin-bottom: 15px;
    }
    
    .device-location {
      color: #666;
      font-size: 14px;
      margin-bottom: 10px;
    }
    
    .device-status {
      font-weight: bold;
      font-size: 14px;
    }
    
    .copy-link-btn {
      background: #f8f9fa;
      border: 1px solid #e0e0e0;
      color: #666;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      margin-top: 10px;
      transition: all 0.3s;
    }
    
    .copy-link-btn:hover {
      background: #E0002B;
      color: white;
      border-color: #E0002B;
    }
    
    /* Footer */
    .footer {
      background: #E0002B;
      color: white;
      padding: 40px 30px 20px;
      margin-top: 60px;
    }
    
    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 200px 1fr;
      gap: 40px;
    }
    
    .footer-logo {
      font-size: 48px;
      font-weight: bold;
      line-height: 1;
    }
    
    .footer-links {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 30px;
    }
    
    .footer-section h4 {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 15px;
    }
    
    .footer-section a {
      color: white;
      text-decoration: none;
      font-size: 14px;
      display: block;
      margin-bottom: 8px;
      transition: opacity 0.3s;
    }
    
    .footer-section a:hover {
      opacity: 0.8;
    }
    
    .social-icons {
      display: flex;
      gap: 15px;
      margin-top: 15px;
    }
    
    .social-icon {
      width: 32px;
      height: 32px;
      background: rgba(255,255,255,0.2);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .social-icon:hover {
      background: rgba(255,255,255,0.3);
    }
    
    .footer-bottom {
      border-top: 1px solid rgba(255,255,255,0.2);
      margin-top: 30px;
      padding-top: 20px;
      text-align: center;
      font-size: 12px;
      opacity: 0.8;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .header-top {
        flex-direction: column;
        gap: 15px;
      }
      
      
      .device-grid {
        grid-template-columns: 1fr;
      }
      
      .footer-content {
        grid-template-columns: 1fr;
        gap: 30px;
      }
      
      .footer-links {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-top">
      <div class="logo-section">
        <div class="logo">BO</div>
        <div>
          <div class="university-name">Hochschule Bochum</div>
          <div class="tagline">Technik Wirtschaft Gesundheit</div>
        </div>
      </div>
      <nav class="nav-main">
        <a href="#">Studium</a>
        <a href="#">Forschung</a>
        <a href="#">Service</a>
        <a href="#">Die BO</a>
      </nav>
    </div>
    
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div id="content">
      <!-- Content will be dynamically loaded here -->
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-logo">BO</div>
      
      <div class="footer-links">
        <div class="footer-section">
          <h4>Informationen</h4>
          <a href="#">Lageplan & Anfahrt</a>
          <a href="#">Karriere</a>
          <a href="#">Notfall-Infos</a>
          <a href="#">Barrierefreiheit</a>
          <a href="#">Datenschutzerkl√§rung</a>
          <a href="#">Impressum</a>
        </div>
        
        <div class="footer-section">
          <h4>Im √úberblick</h4>
          <a href="#">Bachelorstudieng√§nge</a>
          <a href="#">Masterstudieng√§nge</a>
          <a href="#">Bewerben & Einschreiben</a>
        </div>
        
        <div class="footer-section">
          <h4>Service</h4>
          <a href="#">Stundenpl√§ne</a>
          <a href="#">Jobb√∂rse Catapult</a>
          <a href="#">Kontakt</a>
        </div>
        
        <div class="footer-section">
          <h4>Social Media</h4>
          <div class="social-icons">
            <div class="social-icon">üì∑</div>
            <div class="social-icon">üíº</div>
            <div class="social-icon">üì∫</div>
            <div class="social-icon">üìò</div>
            <div class="social-icon">‚ùå</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="footer-bottom">
      ¬© 2024 Hochschule Bochum - Alle Rechte vorbehalten
    </div>
  </footer>

<script>
(async () => {
  try {
    // 1. ID aus der URL ziehen
    const id = new URLSearchParams(location.search).get('id');

    // 2. JSON-Tabelle laden
    let daten;
    try {
      const response = await fetch('./assets/devices.json');
      if (!response.ok) throw new Error('Ger√§tedaten konnten nicht geladen werden: ' + response.status);
      daten = await response.json();
    } catch (err) {
      document.getElementById('content').innerHTML = '<div class="device-detail"><h2>Fehler beim Laden der Ger√§tedaten: ' + err + '</h2></div>';
      console.error('Fehler beim Laden der Ger√§tedaten:', err);
      return;
    }

    // Wenn keine ID: Liste aller Ger√§te nach Kategorien anzeigen
    if(!id){
      // Group devices by category
      const categories = {};
      for(const [key, g] of Object.entries(daten)){
        const category = g.kategorie || 'Unbekannt';
        if(!categories[category]){
          categories[category] = [];
        }
        categories[category].push([key, g]);
      }
      
      let html = '<h1 class="page-title">Alle Ger√§te nach Kategorien</h1>';
      
      // Sort categories
      const sortedCategories = Object.keys(categories).sort();
      
      for(const category of sortedCategories){
        const devices = categories[category];
        html += `
          <div class="category-section">
            <h2 class="category-title">${category} (${devices.length} Ger√§te)</h2>
            <div class="device-grid" id="grid-${category.replace(/\s+/g, '-')}"></div>
          </div>
        `;
      }
      
      document.getElementById('content').innerHTML = html;
      
      // Populate each category grid
      for(const category of sortedCategories){
        const devices = categories[category];
        const grid = document.getElementById(`grid-${category.replace(/\s+/g, '-')}`);
        
        for(const [key, g] of devices){
          const card = document.createElement('div');
          card.className = 'device-card';
          card.onclick = () => window.location.href = `?id=${key}`;
          
          const statusClass = g.status === 'verf√ºgbar' ? 'status-available' : 
                             g.status === 'defekt' ? 'status-defect' : 'status-borrowed';
          
          card.innerHTML = `
            <div class="device-id">${key}</div>
            <h3>${g.name}</h3>
            <div class="device-location">üìç ${g.standort}</div>
            <div class="device-status ${statusClass}">Status: ${g.status}</div>
            <button class="copy-link-btn" onclick="event.stopPropagation(); copyDeviceLink('${key}')">
              üìã Link kopieren
            </button>
          `;
          grid.appendChild(card);
        }
      }
      return;
    }

    // 3. Ger√§t anzeigen oder Fehler melden
    const g = daten[id];
    if(!g){ 
      document.getElementById('content').innerHTML = '<div class="device-detail"><h2>Ger√§t ‚Äû' + id + '" nicht bekannt.</h2></div>'; 
      return; 
    }

    // Check localStorage for borrowed status and name
    const borrowed = localStorage.getItem('borrowed_' + id);
    const borrower = localStorage.getItem('borrower_' + id);
    
    let statusText = g.status;
    let statusClass = g.status === 'verf√ºgbar' ? 'status-available' : 
                     g.status === 'defekt' ? 'status-defect' : 'status-borrowed';
    let borrowerText = '';
    let showBorrowBtn = false;
    
    if (borrowed && borrower) {
      statusText = 'ausgeliehen';
      statusClass = 'status-borrowed';
      borrowerText = `(Entliehen von: ${borrower})`;
    } else if (g.status === 'verf√ºgbar') {
      showBorrowBtn = true;
    }

    document.getElementById('content').innerHTML = `
      <div class="device-detail">
        <h1 class="device-name">${g.name}</h1>
        <div class="device-info">
          <div class="info-item">
            <div class="info-label">Ger√§te-ID</div>
            <div class="info-value">${id}</div>
          </div>
          <div class="info-item">
            <div class="info-label">Standort</div>
            <div class="info-value">${g.standort}</div>
          </div>
          <div class="info-item">
            <div class="info-label">Status</div>
            <div class="info-value ${statusClass}">${statusText} ${borrowerText}</div>
          </div>
        </div>
        ${showBorrowBtn ? '<button class="borrow-btn" id="borrow-btn">Ger√§t ausleihen</button>' : ''}
        <button class="copy-link-btn" onclick="copyDeviceLink('${id}')" style="margin-top: 15px;">
          üìã Ger√§telink kopieren
        </button>
      </div>
    `;

    // Add borrow functionality
    if (showBorrowBtn) {
      const btn = document.getElementById('borrow-btn');
      if (btn) {
        btn.onclick = function() {
          const name = prompt('Bitte geben Sie Ihren Namen ein:');
          if (name && name.trim()) {
            localStorage.setItem('borrowed_' + id, '1');
            localStorage.setItem('borrower_' + id, name.trim());
            location.reload(); // Reload to show updated status
          }
        };
      }
    }

  } catch (e) {
    document.getElementById('content').innerHTML = '<div class="device-detail"><h2>Unerwarteter Fehler: ' + e + '</h2></div>';
    console.error('Unerwarteter Fehler:', e);
  }
})();

// Copy device link function
function copyDeviceLink(deviceId) {
  const url = window.location.origin + window.location.pathname + '?id=' + deviceId;
  navigator.clipboard.writeText(url).then(() => {
    alert('Link wurde in die Zwischenablage kopiert!');
  }).catch(() => {
    // Fallback for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = url;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    alert('Link wurde in die Zwischenablage kopiert!');
  });
}
</script>
</body>
</html>